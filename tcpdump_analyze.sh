#!/bin/bash
# === –ü–∞—Ä–∞–º–µ—Ç—Ä—ã ===
INTERFACE="ens3"
CAPTURE_FILE="/tmp/capture.pcap"
DURATION=30  # –í—Ä–µ–º—è –∑–∞—Ö–≤–∞—Ç–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö

# === –ó–∞—Ö–≤–∞—Ç —Ç—Ä–∞—Ñ–∏–∫–∞ ===
echo "üì° –ó–∞—Ö–≤–∞—Ç —Ç—Ä–∞—Ñ–∏–∫–∞ –Ω–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ $INTERFACE –≤ —Ç–µ—á–µ–Ω–∏–µ $DURATION —Å–µ–∫—É–Ω–¥..."
sudo tcpdump -i "$INTERFACE" -w "$CAPTURE_FILE" -G "$DURATION" -W 1
echo "‚úÖ –ó–∞—Ö–≤–∞—Ç –∑–∞–≤–µ—Ä—à–µ–Ω. –§–∞–π–ª: $CAPTURE_FILE"

# === –ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞—Ñ–∏–∫–∞ ===
echo "üìä –ù–∞—á–∏–Ω–∞–µ–º –∞–Ω–∞–ª–∏–∑ —Ç—Ä–∞—Ñ–∏–∫–∞..."

# 1. –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞–∫–µ—Ç–æ–≤
echo -e "\nüì¶ –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞–∫–µ—Ç–æ–≤:"
tcpdump -r "$CAPTURE_FILE" | wc -l

# 2. –¢–æ–ø-10 IP-–∞–¥—Ä–µ—Å–æ–≤-–∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
echo -e "\nüåê –¢–æ–ø-10 IP-–∞–¥—Ä–µ—Å–æ–≤-–∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:"
tcpdump -nn -r "$CAPTURE_FILE" | awk '{print $3}' | cut -d'.' -f1-4 | sort | uniq -c | sort -nr | head -10

# 3. –¢–æ–ø-10 IP-–∞–¥—Ä–µ—Å–æ–≤-–ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π
echo -e "\nüéØ –¢–æ–ø-10 IP-–∞–¥—Ä–µ—Å–æ–≤-–ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π:"
tcpdump -nn -r "$CAPTURE_FILE" | awk '{print $5}' | cut -d'.' -f1-4 | sed 's/:.*//' | sort | uniq -c | sort -nr | head -10

# 4. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–æ—Ä—Ç–∞–º
echo -e "\nüîå –¢–æ–ø-10 –ø–æ—Ä—Ç–æ–≤:"
tcpdump -nn -r "$CAPTURE_FILE" | awk '{print $5}' | grep ':' | cut -d':' -f2 | sort | uniq -c | sort -nr | head -10

# 5. –ü–æ–¥—Å—á–µ—Ç –ø–∞–∫–µ—Ç–æ–≤ –ø–æ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞–º
echo -e "\nüõ°Ô∏è –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞–º:"
tcpdump -nn -r "$CAPTURE_FILE" | awk '{print $2}' | sort | uniq -c | sort -nr

# 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ SYN)
echo -e "\nüö® –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (SYN-–ø–∞–∫–µ—Ç—ã):"
tcpdump -nn -r "$CAPTURE_FILE" 'tcp[tcpflags] & tcp-syn != 0' | awk '{print $3}' | cut -d'.' -f1-4 | sort | uniq -c | sort -nr | head -10

echo -e "\n‚úÖ –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω. –§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω: $CAPTURE_FILE"
